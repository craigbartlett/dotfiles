#!/usr/bin/bash

# TODO:
# - check return code of qdbus ( is clementine running? )

# MAGIC!
# sample output of qdbus when track is
# playing:
# [Argument: (iiii) 0, 0, 0, 0]
# paused:
# [Argument: (iiii) 1, 0, 0, 0]
# stopped:
# [Argument: (iiii) 2, 0, 0, 0]

status=$(qdbus --literal org.mpris.clementine /Player org.freedesktop.MediaPlayer.GetStatus | awk '{ gsub(",","",$3); print $3}')

# if playing, else
if [ "$status" -eq 0 ]; then
    qdbus org.mpris.clementine /Player org.freedesktop.MediaPlayer.GetMetadata | awk '
    /artist: / {
        gsub("artist: ","")
        printf $0
        printf " - "
    }
    /title: / {
        gsub("title: ","")
        printf $0
        printf "\n"
    }
    '
else
    exit 1
fi
